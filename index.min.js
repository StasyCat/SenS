function GetElm(a){return document.getElementById(a)}
function Onload(){GetElm("song").addEventListener("click",function(){UI.Fadeout(GetElm("detail"));UI.Fadein(GetElm("selectsong"));ReflushSongList()});GetElm("speed").addEventListener("click",function(){var a=parseFloat((prompt("\u697d\u8b5c\u304c\u843d\u3061\u308b\u30b9\u30d4\u30fc\u30c9\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059(0.5~5.0\u500d)...")||"").replace(/[^0-9\.]+/g,""));isNaN(a)||(GetElm("speed").innerText="Speedx"+Math.min(5,Math.max(.5,(10*a<<0)/10)).toFixed(1),GetElm("speed").setAttribute("speed",
""+Math.min(5,Math.max(.5,(10*a<<0)/10))),VerifyMenu())});GetElm("name").addEventListener("click",function(){if("_"!=GetElm("name").getAttribute("can"))alert("\u3082\u3046\u8ffd\u52a0\u6e08\u307f\u3067\u3059\u306e\u3067\u8ffd\u52a0\u3067\u304d\u306a\u3044\u3093\u3067\u3059\u3088\u3002\u307e\u3042\u3001\u8a31\u3057\u3066\u3084\u3063\u3066\u304f\u3060\u3055\u3044");else{var a=prompt("\u30e9\u30f3\u30ad\u30f3\u30b0\u3078\u540d\u524d\u3068\u3068\u3082\u306b\u767b\u9332\u3067\u304d\u307e\u3059...");null!=
a&&(GetElm("name").setAttribute("can","#"),AddRanking(a))}});GetElm("se").addEventListener("click",function(){GetElm("se").classList.contains("selbtn")?(GetElm("se").classList.add("unselbtn"),GetElm("se").classList.remove("selbtn"),GetElm("se").innerText="SE-Off",Game.PlaySE=!1):(GetElm("se").classList.remove("selbtn"),GetElm("se").classList.add("unselbtn"),GetElm("se").innerText="SE-On",Game.PlaySE=!0)});Game.PlaySE=GetElm("se").classList.contains("selbtn");Util.LoadScript("songs.js",function(){window.SongList=
window.SongList.sort(function(a,b){return a.Title<b.Title?-1:a.Title>b.Title?1:0});ReflushSongList();ReflushTagList()});setTimeout(function(){ShowMenu()},500)}
function ShowMenu(){UI.ChangeTitle("Song/Speed");UI.Fadein(GetElm("menu"));UI.Fadein(GetElm("game"));UI.Fadeout(GetElm("gameback"));UI.Fadeout(GetElm("fin"));UI.DeActiveBtn(GetElm("prev"));UI.DeActiveBtn(GetElm("next"));UI.UnBlink(GetElm("next"));GetElm("next").addEventListener("click",function b(){GetElm("next").classList.contains("activebtn")&&(GetElm("next").removeEventListener("click",b),ShowGame())});VerifyMenu()}
function VerifyMenu(){"_"!=GetElm("song").getAttribute("song")?(UI.ActiveBtn(GetElm("next")),UI.Blink(GetElm("next")),ReflushPreview()):UI.DeActiveBtn(GetElm("next"))}
function ReflushTagList(){GetElm("tags").innerHTML="";var a={};window.SongList.forEach(function(b){a[b.Level]=1});Object.keys(a).forEach(function(a){var b=document.createElement("li");b.innerText=a;b.addEventListener("click",function(){b.classList.contains("selbtn")?b.classList.remove("selbtn"):b.classList.add("selbtn");ReflushSongList()});GetElm("tags").appendChild(b)});GetElm("tags-name").innerText="Level"}
function ReflushSongList(){function a(a,b){var d=document.createElement("li");d.innerText=a.Title;d.addEventListener("click",function(){GetElm("song").innerText=a.Title;GetElm("song").setAttribute("song",b);DetailReflushWithSong();VerifyMenu();UI.Fadeout(GetElm("selectsong"));UI.Fadein(GetElm("detail"))});GetElm("songlist").appendChild(d)}for(var b=GetElm("tags").children,d=[],c=0;c<b.length;c++){var e=b.item(c);e.classList.contains("selbtn")&&d.push(e.innerText)}GetElm("songlist").innerHTML="";0==
d.length?window.SongList.forEach(a):window.SongList.forEach(function(b,c){d.some(function(a){return a==b.Level})&&a(b,c)})}
function DetailReflushWithSong(){GetElm("detailtext").innerText="\u7e26\u306b7\u672c\u30ec\u30fc\u30f3\u304c\u3042\u308a\u307e\u3057\u3066\u3001\u5de6\u304b\u3089\u9806\u306b\u3001[S] [D] [F] [Space] [J] [K] [L] \u306e\u30ad\u30fc\u3092\u62bc\u3057\u3066\u3001\u843d\u3061\u3066\u304f\u308b\u8b5c\u9762\u3092\u53e9\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u66f2\u3078\u306e\u30b3\u30e1\u30f3\u30c8\n"+window.SongList[parseInt(GetElm("song").getAttribute("song"),10)].Detail}
function ShowGame(){function a(){b++;3==b&&(StartGame(),GetElm("prev").addEventListener("click",function c(){GetElm("prev").removeEventListener("click",c);Game.FinishTime=0;ShowMenu()}))}var b=0;UI.ChangeTitle(GetElm("song").innerText);UI.Fadeout(GetElm("menu"),a);UI.Fadein(GetElm("game"),a);UI.Fadein(GetElm("gameback"),a);UI.Fadeout(GetElm("fin"),a);UI.ActiveBtn(GetElm("prev"));UI.DeActiveBtn(GetElm("next"));UI.UnBlink(GetElm("next"))}function StartGame(){Game.AutoMode=!1;Game.Init()}
function ReflushPreview(){Game.AutoMode=!1;Game.Speed=5E3/parseFloat(GetElm("speed").getAttribute("speed"));Game.Init();Game.AutoMode=!0}
function ShowFin(){GetElm("name").setAttribute("can","_");GetElm("name").innerText="Enter your name...";UI.ChangeTitle("Result "+Game.Score+"pt");UI.Fadeout(GetElm("menu"));UI.Fadeout(GetElm("game"));UI.Fadeout(GetElm("gameback"));UI.Fadein(GetElm("fin"));UI.ActiveBtn(GetElm("prev"));UI.DeActiveBtn(GetElm("next"));UI.UnBlink(GetElm("next"));GetElm("prev").addEventListener("click",function b(){GetElm("prev").removeEventListener("click",b);ShowMenu()});ReflushRanking()}var RankingDatas=[];
function ReflushRanking(){var a=GetElm("rankinglist");a.innerHTML="";MyStorage.Get(window.SongList[parseInt(GetElm("song").getAttribute("song"),10)].File,function(b){RankingDatas=b.sort(function(a,b){return a.p-b.p});RankingDatas.forEach(function(b,c){var d=document.createElement("li");d.innerHTML='<span class="rank">#'+(c+1)+'</span><span class="score">'+b.p+'pt</span><span class="name">'+b.n+"</span>";a.appendChild(d)})})}
function AddRanking(a){MyStorage.Add(window.SongList[parseInt(GetElm("song").getAttribute("song"),10)].File,{p:Game.Score,n:a},function(){GetElm("name").innerText=a+" Added!";RankingDatas.push({p:Game.Score,n:a});RankingDatas=RankingDatas.sort(function(a,b){return a.p-b.p});var b=GetElm("rankinglist");b.innerHTML="";RankingDatas.forEach(function(a,c){var d=document.createElement("li");d.innerHTML='<span class="rank">#'+(c+1)+'</span><span class="score">'+a.p+'pt</span><span class="name">'+a.n+"</span>";
b.appendChild(d)})})}var Drawing=function(a,b){var d=this;this.Parent=b;if(a.getContext)this.ctx=a.getContext("2d");else throw"Canvas\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059";this.Scaley=this.Scalex=1;var c=this;(function(a){var b=!1;window.addEventListener("resize",function(){!1!==b&&clearTimeout(b);b=setTimeout(a,100)})})(function(){return d.OnResize.call(c)});this.OnResize()};
Drawing.prototype.ChangeDPR=function(a){var b=this.ctx.canvas;this.Scalex=(a||window.devicePixelRatio||1)*this.Parent.clientWidth;this.Scaley=(a||window.devicePixelRatio||1)*this.Parent.clientHeight;b.width=this.Scalex<<0;b.height=this.Scaley<<0;this.ctx.lineWidth=a||window.devicePixelRatio||1;console.log("DPR: "+a+"/"+(window.devicePixelRatio||1))};
Drawing.prototype.OnResize=function(){var a=this.ctx.canvas;this.Scalex=(window.devicePixelRatio||1)*this.Parent.clientWidth;this.Scaley=(window.devicePixelRatio||1)*this.Parent.clientHeight;a.width=this.Scalex<<0;a.height=this.Scaley<<0;a.style.width=this.Parent.clientWidth+"px";a.style.height=this.Parent.clientHeight+"px";this.ctx.lineWidth=window.devicePixelRatio||1};
Drawing.prototype.Path=function(a){this.ctx.beginPath();a=a();"Fill"in a&&(this.ctx.fillStyle=a.Fill,this.ctx.fill());"Stroke"in a&&(this.ctx.strokeStyle=a.Stroke,this.ctx.stroke())};Drawing.prototype.Alpha=function(a){this.ctx.globalAlpha=a};Drawing.prototype.Line=function(a,b,d,c){this.ctx.moveTo(a*this.Scalex<<0,b*this.Scaley<<0);this.ctx.lineTo(d*this.Scalex<<0,c*this.Scaley<<0)};
Drawing.prototype.Rect=function(a,b,d,c){this.ctx.rect(a*this.Scalex<<0,b*this.Scaley<<0,d*this.Scalex<<0,c*this.Scaley<<0)};Drawing.prototype.Round=function(a,b,d){this.ctx.arc(a*this.Scalex<<0,b*this.Scaley<<0,d*Math.min(this.Scalex,this.Scaley)<<0,-.5*Math.PI,2*Math.PI)};
Drawing.prototype.LongRound=function(a,b,d,c){this.ctx.arc(a*this.Scalex<<0,b*this.Scaley<<0,c*Math.min(this.Scalex,this.Scaley)<<0,-Math.PI,0);this.ctx.arc(a*this.Scalex<<0,(b+d)*this.Scaley<<0,c*Math.min(this.Scalex,this.Scaley)<<0,0,-Math.PI)};
Drawing.prototype.Fill=function(a,b){var d=this.ctx.fillStyle,c=this.ctx.globalCompositeOperation;this.ctx.fillStyle=a;this.ctx.globalCompositeOperation=b||"source-over";this.ctx.fillRect(0,0,this.Scalex<<0,this.Scaley<<0);this.ctx.fillStyle=d;this.ctx.globalCompositeOperation=c};
var Game={_:{Keys:[83,68,70,32,74,75,76],MakingLongKeys:[87,69,82,66,85,73,79],ReadyTime:1E3,BorderY:.8,Radius:.5,MaxScoreLimitGOSA:50,LimitGOSA:200,MistakeScore:-100,SECount:50,SEPath:"Tap.mp3",_FitToKey:1},Audio:new Audio,SE:[new Audio],PlaySE:!1,FitToKey:!1,Draw:void 0,Lines:[{Color:0,Light:0,Nodes:[{Time:[],_:{Pressed:!1}}]}],MakingMode:!1,AutoMode:!1,MusicFile:"",FinishTime:0,Speed:5E3,Score:0,Tickings:0,Combo:0,Init:function(){Game.Nodes=void 0;Game.Lines=void 0;Game.Nodes=[];Game.Lines=[];
Game._.Keys.forEach(function(){return Game.Lines.push({Color:0,Light:0,Nodes:[]})});Util.LoadScript("datas/"+window.SongList[parseInt(GetElm("song").getAttribute("song"),10)].File+".js",function(){Game.AutoMode&&window.MusicFile==Game.MusicFile||(Game.MusicFile=window.MusicFile,Game.Audio.src="musics/"+window.MusicFile);Game.Audio.currentTime=0;Game.Audio.playbackRate=1;Game.Score=0;Game.UpdateScore();Game.Combo=0;Game.FinishTime=Infinity;window.NodeText.split(" ").forEach(function(a){a=a.split(":").map(function(a){return parseInt(a,
10)});switch(a.length){case 1:Game.MakingMode||(Game.FinishTime=a[0]);break;case 2:Game.Lines[a[0]].Nodes.push({Time:a.slice(1),_:{Pressed:!1}});break;case 3:Game.Lines[a[0]].Nodes.push({Time:a.slice(1),_:{Pressed:!1,KeyDowned:!1}})}});window.NodeText="";Game.Lines.forEach(function(a){a.Nodes=a.Nodes.sort(function(a,d){return a.Time[0]-d.Time[0]})});Game.Audio.play();0==Game.Tickings&&(Game.Tickings++,Game.Tick())})},Tick:function(){if(1<Game.Tickings)Game.Tickings--;else if(1E3*Game.Audio.currentTime>
Game.FinishTime&&GetElm("fin").classList.contains("fading2"))Game.Tickings--,Game.OnFin();else{FPS.Tick();var a=1E3*Game.Audio.currentTime;Game.Draw.ctx.clearRect(0,0,Game.Draw.Scalex,Game.Draw.Scaley);Game.Draw.ctx.globalCompositeOperation="lighter";Game.Lines.forEach(function(b,d){b.Light*=.95;b.Color*=.95;var c="hsl("+(60*b.Color+60)+","+(100*Math.min(.8,b.Light)+20)+"%,"+(25*Math.min(.4,b.Light)+50)+"%)",e="hsl("+(60*b.Color+60)+","+(100*Math.min(.8,b.Light)+10)+"%,"+(25*Math.min(.4,b.Light)+
50)+"%)",k=1/Game.Lines.length*(d+.5),f=Game._.Radius/Game.Lines.length*(Game.Draw.Scalex>Game.Draw.Scaley?1:Game.Draw.Scalex/Game.Draw.Scaley);Game.Draw.Path(function(){2*d==Game._.Keys.length-1&&Game.Draw.Line(k,0,k,Game._.BorderY-f);Game.Draw.Round(k,Game._.BorderY,Game._.Radius/Game.Lines.length);return{Stroke:c}});b.Nodes.some(function(d){switch(d.Time.length){case 1:var c=Math.pow(1-(d.Time[0]-a)/Game.Speed,5)*(Game._.BorderY+f)-f;if(c<-f)return!Game.MakingMode;if(c>1+f)break;c>Game._.BorderY&&
Game.AutoMode&&!d._.Pressed&&(d._.Pressed=!0,Game.PlaySE&&Game.SEPlay(),b.Light=1);Game.Draw.Path(function(){Game.Draw.Round(k,c,Game._.Radius/Game.Lines.length);return d._.Pressed?{Stroke:e}:{Fill:e}});break;case 2:var l=Math.pow(1-(d.Time[0]-a)/Game.Speed,5)*(Game._.BorderY+f)-f,g=Math.pow(1-(d.Time[1]-a)/Game.Speed,5)*(Game._.BorderY+f)-f;if(l<-f)return!Game.MakingMode;g>1+f||(g>Game._.BorderY&&Game.AutoMode&&!d._.Pressed&&(d._.Pressed=!0,Game.PlaySE&&Game.SEPlay(),b.Light=1),Game.Draw.Path(function(){Game.Draw.LongRound(k,
g,l-g,Game._.Radius/Game.Lines.length);return d._.Pressed?{Stroke:e}:{Fill:e}}))}return!1})});requestAnimationFrame(Game.Tick)}},OnKey:function(a,b,d){if(!Game.AutoMode){var c=1E3*Game.Audio.currentTime;if(78==b)a||Game.Audio.pause();else if(77==b)a||Game.Audio.play();else if(Game.MakingMode||!Game.Audio.paused){var e=Game._.Keys.some(function(e,h){var f,g;if(e==b){if(Game.MakingMode&&d.Ctrl)a||(f=-1,g=Infinity,Game.Lines[0].Nodes.forEach(function(a,b){a._.Pressed&&1==a.Time.length&&Math.abs(c-a.Time[0])<
Math.abs(g)&&(f=b,g=c-a.Time[0])}),0<=f&&(Game.Lines[h].Nodes.push({Time:[Game.Lines[0].Nodes[f].Time[0]],_:{Pressed:!1}}),d.Shift&&Game.Lines[0].Nodes.splice(f,1)));else if(Game.MakingMode&&!d.Shift)a||Game.Lines[h].Nodes.push({Time:[c<<0],_:{Pressed:!1}});else if(f=-1,g=Infinity,Game.Lines[h].Nodes.forEach(function(b,d){var e=Infinity;switch(b.Time.length){case 1:a||b._.Pressed||(e=c-b.Time[0]);break;case 2:a&&b._.KeyDowned?e=c-b.Time[1]:a||b._.KeyDowned||(e=c-b.Time[0])}Math.abs(e)<Math.abs(g)&&
(f=d,g=e)}),Game.MakingMode)0<=f&&!a&&Game.Lines[h].Nodes.splice(f,1);else if(0<=f&&Math.abs(g)<Game._.LimitGOSA){switch(Game.Lines[h].Nodes[f].Time.length){case 1:Game.Lines[h].Nodes[f]._.Pressed=!0;case 2:a?Game.Lines[h].Nodes[f]._.Pressed=!0:Game.Lines[h].Nodes[f]._.KeyDowned=!0}Game.Lines[h].Color=Math.sign(g)*(Math.max(Math.abs(g),Game._.MaxScoreLimitGOSA)-Game._.MaxScoreLimitGOSA)/(Game._.LimitGOSA-Game._.MaxScoreLimitGOSA);Game.Lines[h].Light=1;Game.Combo=Math.min(Game.Combo+1,5);Game.Score+=
Game.Combo/Math.pow((Math.max(Math.abs(g),Game._.MaxScoreLimitGOSA)-Game._.MaxScoreLimitGOSA)/(Game._.LimitGOSA-Game._.MaxScoreLimitGOSA)*.9+.1,2)*5.1+490<<0;Game.UpdateScore();Game.FitToKey&&(0>Game.Lines[h].Color?Game._._FitToKey+=.02:0<Game.Lines[h].Color&&(Game._._FitToKey-=.02),Game._._FitToKey=Math.min(1.5,Math.max(.5,Game._._FitToKey)),Game.Audio.playbackRate=Math.min(1.5,Math.max(.5,Game.Audio.playbackRate-(Game.Audio.playbackRate-Game._._FitToKey)/10)))}else a||(Game.Combo=0,Game.Score+=
Game._.MistakeScore,Game.UpdateScore());return!0}});if(Game.MakingMode&&!e&&(e=Game._.MakingLongKeys.some(function(d,e){if(d==b)return a?Game.Lines[e].Nodes[Game_Onkey_MakingLong[e]].Time[1]=c<<0:(Game.Lines[e].Nodes.push({Time:[c<<0,c+1E4<<0],_:{Pressed:!1,KeyDowned:!1}}),Game_Onkey_MakingLong[e]=Game.Lines[e].Nodes.length-1),!0}),!e)){if(a)return;if(d.Shift){var k=-1,f=Infinity;Game.Lines[0].Nodes.forEach(function(a,b){a._.Pressed&&1==a.Time.length&&Math.abs(c-a.Time[0])<Math.abs(f)&&(k=b,f=c-a.Time[0])});
0<=k&&Game.Lines[0].Nodes.splice(k,1)}else Game.Lines[0].Nodes.push({Time:[c<<0],_:{Pressed:!0}});e=!0}Game.PlaySE&&e&&!a&&Game.SEPlay()}}},OnFin:function(){Game.AutoMode?Game.Init():ShowFin()},OnLoad:function(){Game.SE=[];for(var a=0;a<Game._.SECount;a++){var b=new Audio(Game._.SEPath);b.preload="auto";Game.SE.push(b)}Game.Audio=new Audio;Game.Audio.preload="auto";Game.Audio.onended=function(){Game.Audio.currentTime=0;Game.OnFin()};Game.Draw=new Drawing(GetElm("c1"),GetElm("game"));Game_Keyboard_.Pressed=
[];Game_Onkey_MakingLong=Array(Game._.MakingLongKeys.length);Game._.Keys.forEach(function(a){return Game_Keyboard_.Pressed[a]=!1});document.onkeydown=function(a){a||(a=window.event);if(Game.MakingMode)switch(a.keyCode){case 13:Game.FinishTime=1E3*Game.Audio.currentTime;console.log("--DATA--");var b=[];Game.Lines.forEach(function(a,d){var c=[];a.Nodes.sort(function(a,b){return a.Time[0]-b.Time[0]}).forEach(function(a){a._.Pressed||c.push(d+":"+a.Time.join(":"))});b.push(c.join(" "))});b.push(Game.FinishTime);
console.log('NodeText = "'+b.join(" ")+'";');return;case 67:Game.Audio.playbackRate=Math.min(4,Math.max(.2,Game.Audio.playbackRate-.05));console.log("Speed: "+Game.Audio.playbackRate);return;case 86:Game.Audio.playbackRate=Math.min(4,Math.max(.2,Game.Audio.playbackRate+.05));console.log("Speed: "+Game.Audio.playbackRate);return;case 90:Game.Audio.currentTime=Math.max(0,Game.Audio.currentTime-.5);console.log("Time: "+Game.Audio.currentTime);return;case 88:Game.Audio.currentTime=Math.max(0,Game.Audio.currentTime+
.5);console.log("Time: "+Game.Audio.currentTime);return}if(!Game_Keyboard_[a.keyCode]&&(Game_Keyboard_[a.keyCode]=!0,Game.OnKey(!1,a.keyCode,{Shift:a.shiftKey,Ctrl:a.ctrlKey}),Game.MakingMode&&(a.shiftKey||a.ctrlKey)))if(a.preventDefault)a.preventDefault();else return a.keyCode=0,!1};document.onkeyup=function(a){a||(a=window.event);if(Game_Keyboard_[a.keyCode]&&(Game_Keyboard_[a.keyCode]=!1,Game.OnKey(!0,a.keyCode,{Shift:a.shiftKey,Ctrl:a.ctrlKey}),Game.MakingMode&&(a.shiftKey||a.ctrlKey)))if(a.preventDefault)a.preventDefault();
else return a.keyCode=0,!1};Game.Draw.ctx.canvas.addEventListener("touchstart",function(a){a||(a=window.event);for(var b=0;b<a.touches.length;b++)Game.OnKey(!1,Game._.Keys[a.touches.item(b).clientX/(Game.Draw.Parent.clientWidth/Game._.Keys.length)<<0],{Shift:!1,Ctrl:!1})});Game.Draw.ctx.canvas.addEventListener("touchend",function(a){a||(a=window.event);for(var b=0;b<a.touches.length;b++)Game.OnKey(!0,Game._.Keys[a.touches.item(b).clientX/(Game.Draw.Parent.clientWidth/Game._.Keys.length)<<0],{Shift:!1,
Ctrl:!1})})},SEPlay:function(){for(var a=0;a<Game.SE.length;a++)if(Game.SE[a].paused){Game.SE[a].play();return}console.log("_")},UpdateScore:function(){GetElm("score").innerText=Game.Score}},Game_Keyboard_={Pressed:{}},Game_Onkey_MakingLong=[],FPS={_:{Span:100,EventFn:[function(a){return console.log("FPS: "+a)},function(a){45>a&&.5<FPS._dpr&&(FPS._dpr*=.8,FPS._dpr=Math.min(window.devicePixelRatio||1,Math.max(.5,FPS._dpr)),Game.Draw.ChangeDPR(FPS._dpr));45<a&&FPS._dpr<(window.devicePixelRatio||1)&&
(FPS._dpr+=((window.devicePixelRatio||1)-FPS._dpr)/3+.2,FPS._dpr=Math.min(window.devicePixelRatio||1,Math.max(.5,FPS._dpr)),Game.Draw.ChangeDPR(FPS._dpr))}]},_dpr:window.devicePixelRatio||1,Prev:0,FCount:0,CFPS:0,Tick:function(){FPS.FCount++;if(0==FPS.FCount%FPS._.Span){var a=performance.now();FPS.FCount=0;FPS.CFPS=1E3/(a-FPS.Prev)*FPS._.Span<<0;FPS.Prev=a;FPS._.EventFn.forEach(function(a){a(FPS.CFPS)})}}},UI={DOMs:{Title:void 0},Onload:function(){UI.DOMs.Title=GetElm("title")},ChangeTitle:function(a,
b){b=b||function(){return 0};UI.DOMs.Title.addEventListener("webkitAnimationEnd",function c(){UI.DOMs.Title.classList.contains("fading1")?(UI.DOMs.Title.innerText=a,UI.DOMs.Title.classList.remove("fading1"),UI.DOMs.Title.classList.add("fading2"),setTimeout(function(){UI.DOMs.Title.classList.remove("fading2");UI.DOMs.Title.classList.add("fading3")},0)):(UI.DOMs.Title.classList.remove("fading3"),UI.DOMs.Title.removeEventListener("webkitAnimationEnd",c),b())});UI.DOMs.Title.classList.add("fading1")},
Fadeout:function(a,b){b=b||function(){return 0};a.classList.contains("fading2")?b():(a.addEventListener("webkitAnimationEnd",function c(){a.classList.remove("fading1");a.classList.add("fading2");a.removeEventListener("webkitAnimationEnd",c);b()}),a.classList.add("fading1"))},Fadein:function(a,b){b=b||function(){return 0};a.classList.contains("fading2")?(a.addEventListener("webkitAnimationEnd",function c(){a.classList.remove("fading3");a.removeEventListener("webkitAnimationEnd",c);b()}),a.classList.remove("fading2"),
a.classList.add("fading3")):b()},ActiveBtn:function(a){a.classList.remove("deactivebtn");a.classList.add("activebtn")},DeActiveBtn:function(a){a.classList.remove("activebtn");a.classList.add("deactivebtn")},Blink:function(a){a.classList.add("blink")},UnBlink:function(a){a.classList.remove("blink")}},Util={LoadScript:function(a,b){var d=!1,c=document.getElementsByTagName("head")[0],e=document.createElement("script");e.src=a;c.appendChild(e);e.onload=e.onreadystatechange=function(){d||e.readyState&&
"loaded"!==e.readyState&&"complete"!==e.readyState||(d=!0,b(),e.onload=e.onreadystatechange=null,c&&e.parentNode&&c.removeChild(e))}},URLtoObject:function(){var a={};location.search.substring(1).split("&").forEach(function(b){b=b.split("=");a[b[0]]=b[1]});return a},Polyfill:function(){window.performance=window.performance||{};window.performance.now=window.performance.now||function(){return(new Date).getTime()};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||
window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}},MyStorage={Get:function(a,b){localStorage.getItem(a)?b(JSON.parse(localStorage.getItem(a))):b([])},Add:function(a,b,d){var c=[];try{c=JSON.parse(localStorage.getItem(a))}catch(e){c=[]}c.push(b);localStorage.setItem(a,JSON.stringify(c));d()}};Util.Polyfill();
window.addEventListener("load",function(){try{document.documentElement.requestFullscreen()}catch(b){}var a=Util.URLtoObject();Game.MakingMode="making"in a;Game.PlaySE="se"in a;Game.FitToKey="fit"in a;UI.Onload();Game.OnLoad();Onload();UI.Fadein(GetElm("selectsong"));UI.Fadeout(GetElm("detail"))});