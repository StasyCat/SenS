function c(a){return document.getElementById(a)}
function aa(){c("song").addEventListener("click",function(){g(c("detail"));h(c("selectsong"));l()});c("speed").addEventListener("click",function(){var a=Number.parseFloat((prompt("\u697d\u8b5c\u304c\u843d\u3061\u308b\u30b9\u30d4\u30fc\u30c9\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059(0.5~5.0\u500d)...")||"").replace(/[^0-9\.]+/g,""));Number.isNaN(a)||(c("speed").innerText="Speedx"+Math.min(5,Math.max(.5,(10*a<<0)/10)).toFixed(1),c("speed").setAttribute("speed",""+Math.min(5,Math.max(.5,(10*a<<0)/10))),
n())});c("name").addEventListener("click",function(){if("_"!=c("name").getAttribute("can"))alert("\u3082\u3046\u8ffd\u52a0\u6e08\u307f\u3067\u3059\u306e\u3067\u8ffd\u52a0\u3067\u304d\u306a\u3044\u3093\u3067\u3059\u3088\u3002\u307e\u3042\u3001\u8a31\u3057\u3066\u3084\u3063\u3066\u304f\u3060\u3055\u3044");else{var a=prompt("\u30e9\u30f3\u30ad\u30f3\u30b0\u3078\u540d\u524d\u3068\u3068\u3082\u306b\u767b\u9332\u3067\u304d\u307e\u3059...");null!=a&&(c("name").setAttribute("can","#"),ba(a))}});c("se").addEventListener("click",
function(){c("se").classList.contains("selbtn")?(c("se").classList.add("unselbtn"),c("se").classList.remove("selbtn"),c("se").innerText="SE-Off",q=!1):(c("se").classList.remove("selbtn"),c("se").classList.add("unselbtn"),c("se").innerText="SE-On",q=!0)});q=c("se").classList.contains("selbtn");r("songs.js",function(){window.SongList=window.SongList.sort(function(a,b){return a.Title<b.Title?-1:a.Title>b.Title?1:0});l();da()});setTimeout(function(){u()},500)}
function u(){v("Song/Speed");h(c("menu"));h(c("game"));g(c("gameback"));g(c("fin"));w(c("prev"));w(c("next"));x();c("next").addEventListener("click",function b(){c("next").classList.contains("activebtn")&&(c("next").removeEventListener("click",b),ea())});n()}function n(){"_"!=c("song").getAttribute("song")?(y(c("next")),c("next").classList.add("blink"),z=!1,A=5E3/Number.parseFloat(c("speed").getAttribute("speed")),B(),z=!0):w(c("next"))}
function da(){c("tags").innerHTML="";var a={};window.SongList.forEach(function(b){a[b.Level]=1});Object.keys(a).forEach(function(a){var b=document.createElement("li");b.innerText=a;b.addEventListener("click",function(){b.classList.contains("selbtn")?b.classList.remove("selbtn"):b.classList.add("selbtn");l()});c("tags").appendChild(b)});c("tags-name").innerText="Level"}
function l(){function a(a,b){var e=document.createElement("li");e.innerText=a.Title;e.addEventListener("click",function(){c("song").innerText=a.Title;c("song").setAttribute("song",b);c("detailtext").innerText="\u7e26\u306b7\u672c\u30ec\u30fc\u30f3\u304c\u3042\u308a\u307e\u3057\u3066\u3001\u5de6\u304b\u3089\u9806\u306b\u3001[S] [D] [F] [Space] [J] [K] [L] \u306e\u30ad\u30fc\u3092\u62bc\u3057\u3066\u3001\u843d\u3061\u3066\u304f\u308b\u8b5c\u9762\u3092\u53e9\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u66f2\u3078\u306e\u30b3\u30e1\u30f3\u30c8\n"+
window.SongList[Number.parseInt(c("song").getAttribute("song"),10)].Detail;n();g(c("selectsong"));h(c("detail"))});c("songlist").appendChild(e)}for(var b=c("tags").children,e=[],d=0;d<b.length;d++){var f=b.item(d);f.classList.contains("selbtn")&&e.push(f.innerText)}c("songlist").innerHTML="";0==e.length?window.SongList.forEach(a):window.SongList.forEach(function(b,d){e.some(function(a){return a==b.Level})&&a(b,d)})}
function ea(){function a(){b++;3==b&&(z=!1,B(),c("prev").addEventListener("click",function d(){c("prev").removeEventListener("click",d);C=0;u()}))}var b=0;v(c("song").innerText);g(c("menu"),a);h(c("game"),a);h(c("gameback"),a);g(c("fin"),a);y(c("prev"));w(c("next"));x()}
function D(){c("name").setAttribute("can","_");c("name").innerText="Enter your name...";v("Result "+E+"pt");g(c("menu"));g(c("game"));g(c("gameback"));h(c("fin"));y(c("prev"));w(c("next"));x();c("prev").addEventListener("click",function b(){c("prev").removeEventListener("click",b);u()});fa()}var F=[];
function fa(){var a=c("rankinglist");a.innerHTML="";ga(function(b){F=b.sort(function(a,b){return a.p-b.p});F.forEach(function(b,d){var e=document.createElement("li");e.innerHTML='<span class="rank">#'+(d+1)+'</span><span class="score">'+b.p+'pt</span><span class="name">'+b.n+"</span>";a.appendChild(e)})})}
function ba(a){ha(window.SongList[Number.parseInt(c("song").getAttribute("song"),10)].File,{p:E,n:a},function(){c("name").innerText=a+" Added!";F.push({p:E,n:a});F=F.sort(function(a,b){return a.p-b.p});var b=c("rankinglist");b.innerHTML="";F.forEach(function(a,d){var e=document.createElement("li");e.innerHTML='<span class="rank">#'+(d+1)+'</span><span class="score">'+a.p+'pt</span><span class="name">'+a.n+"</span>";b.appendChild(e)})})}
function G(a,b){var e=this;this.m=b;if(a.getContext)this.c=a.getContext("2d");else throw"Canvas\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059";this.i=this.h=1;var d=this;(function(a){var b=!1;window.addEventListener("resize",function(){!1!==b&&clearTimeout(b);b=setTimeout(a,100)})})(function(){return e.v.call(d)});this.v()}
G.prototype.v=function(){var a=this.c.canvas;this.h=(window.devicePixelRatio||1)*this.m.clientWidth;this.i=(window.devicePixelRatio||1)*this.m.clientHeight;a.width=this.h<<0;a.height=this.i<<0;a.style.width=this.m.clientWidth+"px";a.style.height=this.m.clientHeight+"px";this.c.lineWidth=window.devicePixelRatio||1};function H(a){var b=I;b.c.beginPath();a=a();"Fill"in a&&(b.c.fillStyle=a.w,b.c.fill());"Stroke"in a&&(b.c.strokeStyle=a.B,b.c.stroke())}
G.prototype.Rect=function(a,b,e,d){this.c.rect(a*this.h<<0,b*this.i<<0,e*this.h<<0,d*this.i<<0)};function J(a,b){var e=I;e.c.arc(a*e.h<<0,b*e.i<<0,.5/K.length*Math.min(e.h,e.i)<<0,-.5*Math.PI,2*Math.PI)}G.prototype.w=function(a,b){var e=this.c.fillStyle,d=this.c.globalCompositeOperation;this.c.fillStyle=a;this.c.globalCompositeOperation=b||"source-over";this.c.fillRect(0,0,this.h<<0,this.i<<0);this.c.fillStyle=e;this.c.globalCompositeOperation=d};
var L=[83,68,70,32,74,75,76],M=[87,69,82,66,85,73,79],N=1,O=new Audio,P=[new Audio],q=!1,Q=!1,I=void 0,K=[{l:0,j:0,b:[{a:[],g:{f:!1}}]}],R=!1,z=!1,ia="",C=0,A=5E3,E=0,S=0,T=0;
function B(){K=void 0;K=[];L.forEach(function(){return K.push({l:0,j:0,b:[]})});r("datas/"+window.SongList[Number.parseInt(c("song").getAttribute("song"),10)].File+".js",function(){z&&window.MusicFile==ia||(ia=window.MusicFile,O.src="musics/"+window.MusicFile);O.currentTime=0;O.playbackRate=1;E=0;U();T=0;C=Infinity;window.NodeText.split(" ").forEach(function(a){a=a.split(":").map(function(a){return Number.parseInt(a,10)});switch(a.length){case 1:R||(C=a[0]);break;case 2:K[a[0]].b.push({a:a.slice(1),
g:{f:!1}});break;case 3:K[a[0]].b.push({a:a.slice(1),g:{f:!1,u:!1}})}});window.NodeText="";K.forEach(function(a){a.b=a.b.sort(function(a,e){return a.a[0]-e.a[0]})});O.play();0==S&&(S++,ja())})}
function ja(){if(1<S)S--;else if(1E3*O.currentTime>C&&c("fin").classList.contains("fading2"))S--,z?B():D();else{var a=1E3*O.currentTime;I.c.clearRect(0,0,I.h,I.i);I.c.globalCompositeOperation="lighter";K.forEach(function(b,e){b.j*=.95;b.l*=.95;var d="hsl("+(60*b.l+60)+","+(100*Math.min(.8,b.j)+20)+"%,"+(25*Math.min(.4,b.j)+50)+"%)",f="hsl("+(60*b.l+60)+","+(100*Math.min(.8,b.j)+10)+"%,"+(25*Math.min(.4,b.j)+50)+"%)",t=1/K.length*(e+.5),k=.5/K.length*(I.h>I.i?1:I.h/I.i);H(function(){if(2*e==L.length-
1){var a=.8-k,b=I;b.c.moveTo(t*b.h<<0,0*b.i<<0);b.c.lineTo(t*b.h<<0,a*b.i<<0)}J(t,.8);return{Stroke:d}});b.b.some(function(e){switch(e.a.length){case 1:var d=Math.pow(1-(e.a[0]-a)/A,5)*(.8+k)-k;if(d<-k)return!R;if(d>1+k)break;.8<d&&z&&!e.g.f&&(e.g.f=!0,q&&V(),b.j=1);H(function(){J(t,d);return e.g.f?{Stroke:f}:{Fill:f}});break;case 2:var ca=Math.pow(1-(e.a[0]-a)/A,5)*(.8+k)-k,m=Math.pow(1-(e.a[1]-a)/A,5)*(.8+k)-k;if(ca<-k)return!R;m>1+k||(.8<m&&z&&!e.g.f&&(e.g.f=!0,q&&V(),b.j=1),H(function(){var a=
ca-m,b=I,d=.5/K.length;b.c.arc(t*b.h<<0,m*b.i<<0,d*Math.min(b.h,b.i)<<0,-Math.PI,0);b.c.arc(t*b.h<<0,(m+a)*b.i<<0,d*Math.min(b.h,b.i)<<0,0,-Math.PI);return e.g.f?{Stroke:f}:{Fill:f}}))}return!1})});requestAnimationFrame(ja)}}
function W(a,b,e){if(!z){var d=1E3*O.currentTime;if(78==b)a||O.pause();else if(77==b)a||O.play();else if(R||!O.paused){var f=L.some(function(f,p){var k,m;if(f==b){if(R&&e.s)a||(k=-1,m=Infinity,K[0].b.forEach(function(a,b){a.g.f&&1==a.a.length&&Math.abs(d-a.a[0])<Math.abs(m)&&(k=b,m=d-a.a[0])}),0<=k&&(K[p].b.push({a:[K[0].b[k].a[0]],g:{f:!1}}),e.o&&K[0].b.splice(k,1)));else if(R&&!e.o)a||K[p].b.push({a:[d<<0],g:{f:!1}});else if(k=-1,m=Infinity,K[p].b.forEach(function(b,e){var f=Infinity;switch(b.a.length){case 1:a||
b.g.f||(f=d-b.a[0]);break;case 2:a&&b.g.u?f=d-b.a[1]:a||b.g.u||(f=d-b.a[0])}Math.abs(f)<Math.abs(m)&&(k=e,m=f)}),R)0<=k&&!a&&K[p].b.splice(k,1);else if(0<=k&&200>Math.abs(m)){switch(K[p].b[k].a.length){case 1:K[p].b[k].g.f=!0;case 2:a?K[p].b[k].g.f=!0:K[p].b[k].g.u=!0}K[p].l=Math.sign(m)*(Math.max(Math.abs(m),50)-50)/150;K[p].j=1;T=Math.min(T+1,5);E+=T/Math.pow((Math.max(Math.abs(m),50)-50)/150*.9+.1,2)*5.1+490<<0;U();Q&&(0>K[p].l?N+=.02:0<K[p].l&&(N-=.02),N=Math.min(1.5,Math.max(.5,N)),O.playbackRate=
Math.min(1.5,Math.max(.5,O.playbackRate-(O.playbackRate-N)/10)))}else a||(T=0,E+=-100,U());return!0}});if(R&&!f&&(f=M.some(function(e,f){if(e==b)return a?K[f].b[X[f]].a[1]=d<<0:(K[f].b.push({a:[d<<0,d+1E4<<0],g:{f:!1,u:!1}}),X[f]=K[f].b.length-1),!0}),!f)){if(a)return;if(e.o){var t=-1,k=Infinity;K[0].b.forEach(function(a,b){a.g.f&&1==a.a.length&&Math.abs(d-a.a[0])<Math.abs(k)&&(t=b,k=d-a.a[0])});0<=t&&K[0].b.splice(t,1)}else K[0].b.push({a:[d<<0],g:{f:!0}});f=!0}q&&f&&!a&&V()}}}
function ka(){P=[];for(var a=0;50>a;a++){var b=new Audio("Tap.mp3");b.A="auto";P.push(b)}O=new Audio;O.A="auto";O.onended=function(){O.currentTime=0;z?B():D()};I=new G(c("c1"),c("game"));Y.f=[];X=Array(M.length);L.forEach(function(a){return Y.f[a]=!1});document.onkeydown=function(a){a||(a=window.event);if(R)switch(a.keyCode){case 13:C=1E3*O.currentTime;console.log("--DATA--");var b=[];K.forEach(function(a,e){var d=[];a.b.sort(function(a,b){return a.a[0]-b.a[0]}).forEach(function(a){a.g.f||d.push(e+
":"+a.a.join(":"))});b.push(d.join(" "))});b.push(C);console.log('NodeText = "'+b.join(" ")+'";');return;case 67:O.playbackRate=Math.min(4,Math.max(.2,O.playbackRate-.05));console.log("Speed: "+O.playbackRate);return;case 86:O.playbackRate=Math.min(4,Math.max(.2,O.playbackRate+.05));console.log("Speed: "+O.playbackRate);return;case 90:O.currentTime=Math.max(0,O.currentTime-.5);console.log("Time: "+O.currentTime);return;case 88:O.currentTime=Math.max(0,O.currentTime+.5);console.log("Time: "+O.currentTime);
return}if(!Y[a.keyCode]&&(Y[a.keyCode]=!0,W(!1,a.keyCode,{o:a.shiftKey,s:a.ctrlKey}),R&&(a.shiftKey||a.ctrlKey)))if(a.preventDefault)a.preventDefault();else return a.keyCode=0,!1};document.onkeyup=function(a){a||(a=window.event);if(Y[a.keyCode]&&(Y[a.keyCode]=!1,W(!0,a.keyCode,{o:a.shiftKey,s:a.ctrlKey}),R&&(a.shiftKey||a.ctrlKey)))if(a.preventDefault)a.preventDefault();else return a.keyCode=0,!1};I.c.canvas.addEventListener("touchstart",function(a){a||(a=window.event);for(var b=0;b<a.touches.length;b++)W(!1,
L[a.touches.item(b).clientX/(I.m.clientWidth/L.length)<<0],{o:!1,s:!1})});I.c.canvas.addEventListener("touchend",function(a){a||(a=window.event);for(var b=0;b<a.touches.length;b++)W(!0,L[a.touches.item(b).clientX/(I.m.clientWidth/L.length)<<0],{o:!1,s:!1})})}function V(){for(var a=0;a<P.length;a++)if(P[a].paused){P[a].play();return}console.log("_")}function U(){c("score").innerText=E}var Y={f:{}},X=[],Z=void 0;
function v(a){var b;b=b||function(){return 0};Z.addEventListener("webkitAnimationEnd",function d(){Z.classList.contains("fading1")?(Z.innerText=a,Z.classList.remove("fading1"),Z.classList.add("fading2"),setTimeout(function(){Z.classList.remove("fading2");Z.classList.add("fading3")},0)):(Z.classList.remove("fading3"),Z.removeEventListener("webkitAnimationEnd",d),b())});Z.classList.add("fading1")}
function g(a,b){b=b||function(){return 0};a.classList.contains("fading2")?b():(a.addEventListener("webkitAnimationEnd",function d(){a.classList.remove("fading1");a.classList.add("fading2");a.removeEventListener("webkitAnimationEnd",d);b()}),a.classList.add("fading1"))}
function h(a,b){b=b||function(){return 0};a.classList.contains("fading2")?(a.addEventListener("webkitAnimationEnd",function d(){a.classList.remove("fading3");a.removeEventListener("webkitAnimationEnd",d);b()}),a.classList.remove("fading2"),a.classList.add("fading3")):b()}function y(a){a.classList.remove("deactivebtn");a.classList.add("activebtn")}function w(a){a.classList.remove("activebtn");a.classList.add("deactivebtn")}function x(){c("next").classList.remove("blink")}
function r(a,b){var e=!1,d=document.getElementsByTagName("head")[0],f=document.createElement("script");f.src=a;d.appendChild(f);f.onload=f.onreadystatechange=function(){e||f.readyState&&"loaded"!==f.readyState&&"complete"!==f.readyState||(e=!0,b(),f.onload=f.onreadystatechange=null,d&&f.parentNode&&d.removeChild(f))}}function la(){var a={};location.search.substring(1).split("&").forEach(function(b){b=b.split("=");a[b[0]]=b[1]});return a}
function ga(a){var b=window.SongList[Number.parseInt(c("song").getAttribute("song"),10)].File;localStorage.getItem(b)?a(JSON.parse(localStorage.getItem(b))):a([])}function ha(a,b,e){var d=[];try{d=JSON.parse(localStorage.getItem(a))}catch(f){d=[]}d.push(b);localStorage.setItem(a,JSON.stringify(d));e()}window.performance=window.performance||{};window.performance.now=window.performance.now||function(){return(new Date).getTime()};
window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.addEventListener("load",function(){try{document.documentElement.requestFullscreen()}catch(b){}var a=la();R="making"in a;q="se"in a;Q="fit"in a;Z=c("title");ka();aa();h(c("selectsong"));g(c("detail"))});